## üöÄ WebBooks ‚Äî DevOps-–ø—Ä–æ–µ–∫—Ç 
–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª CI/CD –¥–ª—è Spring Boot-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è WebBooks —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ –æ–±–ª–∞—á–Ω–æ–º Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–µ (Yandex Cloud). 
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –ø—É–±–ª–∏—á–Ω–æ–º—É IP –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ –≤ –≤–µ—Ç–∫—É main. 

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
~~~
Diplom
‚îú‚îÄ‚îÄ webbooks/                     # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ Spring Boot-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ src/                      # Java-–∫–æ–¥ –∏ —Ä–µ—Å—É—Ä—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ pom.xml                   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–±–æ—Ä–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile                # Multi-stage —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
‚îÇ
‚îú‚îÄ‚îÄ infra/
‚îÇ   ‚îú‚îÄ‚îÄ terraform/                # IaC: —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud
‚îÇ   ‚îî‚îÄ‚îÄ k8s/webbooks/             # Helm-—á–∞—Ä—Ç –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îÇ
‚îî‚îÄ‚îÄ .github/workflows/
    ‚îî‚îÄ‚îÄ ci-cd.yml                 # CI/CD pipeline: —Å–±–æ—Ä–∫–∞ ‚Üí —Ç–µ—Å—Ç—ã ‚Üí –¥–µ–ø–ª–æ–π ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
~~~
## ‚òÅÔ∏è –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã 
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ Terraform –∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ Yandex Cloud. 

–®–∞–≥–∏: 
1) –°–æ–∑–¥–∞–π —Ñ–∞–π–ª infra/terraform/terraform.tfvars:
~~~
yc_token     = "–≤–∞—à_OAuth_—Ç–æ–∫–µ–Ω"
yc_cloud_id  = "–≤–∞—à_cloud_id"
yc_folder_id = "–≤–∞—à_folder_id"
~~~

2) –ü—Ä–∏–º–µ–Ω–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
~~~
cd infra/terraform
terraform init
terraform apply
~~~

3) –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–ª—É—á–∏ kubeconfig:

~~~
yc managed-kubernetes cluster get-credentials webbooks-k8s --external
~~~

## üõ†Ô∏è –ü—Ä–∞–≤–∏–ª–∞ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É 

1) –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Terraform.
2) –õ—é–±—ã–µ –ø—Ä–∞–≤–∫–∏ –≤ infra/terraform/*.tf:
    
    * –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ
    * –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ Pull Request
    ~~~
    terraform apply
    ~~~
3) –ü–æ—Å–ª–µ –º–µ—Ä–∂–∞ –≤ main ‚Äî –æ–±–Ω–æ–≤–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –æ–±–ª–∞–∫–µ:
~~~
terraform apply
~~~
4) –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å Yandex Cloud –¥–ª—è —Ä—É—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî —ç—Ç–æ –Ω–∞—Ä—É—à–∏—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

## üîÑ –†–µ–ª–∏–∑–Ω—ã–π —Ü–∏–∫–ª –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ 
CI/CD Workflow 
* PR –≤ main: –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ª–∏–Ω—Ç–∏–Ω–≥, —Å–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç—ã.
* –ö–æ–º–º–∏—Ç –≤ main:
1) –°–±–æ—Ä–∫–∞ JAR ‚Üí Docker-–æ–±—Ä–∞–∑
2) –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ GitHub Container Registry (ghcr.io/naolshevskiy/webbooks)
3) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ Kubernetes
4) –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram —Å –ø—É–±–ª–∏—á–Ω—ã–º IP
         
     

## –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ 
* Docker-–æ–±—Ä–∞–∑—ã:
    * –¢–µ–≥ latest ‚Äî –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
    * –¢–µ–≥ <github.sha> ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–∏—Ç (–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å)
         
* Helm-—Ä–µ–ª–∏–∑—ã: –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è (helm upgrade --install)
* –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ ConfigMap
     
## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è 

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–∫–∏ –∏ –¥–µ–ø–ª–æ—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram.

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: 
1) –°–æ–∑–¥–∞–π –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather 
2) –î–æ–±–∞–≤—å –≤ GitHub Secrets:
    * TELEGRAM_BOT_TOKEN
    * TELEGRAM_CHAT_ID (—É–∑–Ω–∞—Ç—å —á–µ—Ä–µ–∑ @userinfobot )
         
     